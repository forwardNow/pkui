define(function(a){function b(a){var b=c(a.node);return c.extend({},a.options.pkuiOptions,this.defaults,{$dialogContainer:b,$dialog:b.find(".pkui-dialog"),$dialogHeader:b.find(".pkui-dialog-header"),$dialogContent:b.find(".pkui-dialog-content"),$minBtn:b.find(".pkui-dialog-min"),$maxBtn:b.find(".pkui-dialog-max"),$restoreBtn:b.find(".pkui-dialog-restore")})}var c,d,e,f,g;return c=a("jquery"),a("jquery-ui"),g=a("meld"),d=a("../base/utils"),e=a("artDialog"),f={create:function(a){var b,d,f;return f=this,b=c.extend({width:this.defaults.width,height:this.defaults.height},a),d=e(b),this._init(d),g.after(d,"__center",function(){var a,b,e,g;a=d.options.pkuiOptions.$dialogContainer,e=[],g=[],f.getAllDialogContainer().each(function(){var a;a=c(this).offset(),e.push(a.left),g.push(a.top)}),b={left:Math.max.apply(null,e),top:Math.max.apply(null,g)},1!==e.length&&a.offset(b).animate({top:b.top+10,left:b.left+10},"false")}),d},getAllDialogContainer:function(){return c(document.body).children(".pkui-popup")},_init:function(a){var c;c=b.apply(this,[a]),a.options.pkuiOptions=c,c.resizable&&this._setResizable(a),c.canMinimized&&this._bindMinEvent(a),c.canMaximized&&this._bindMaxEvent(a),c.canDragged&&this._setDraggable(a)},_setResizable:function(a){var b=a.options.pkuiOptions.$dialogContent;return b.resizable(),g.before(a,"content",function(){b.resizable("destroy")}),g.after(a,"content",function(){b.resizable({containment:"#daDesktop",disabled:!0})}),this},_setDraggable:function(a){var b=a.options.pkuiOptions;return b.$dialogContainer.draggable({handle:b.$dialogHeader.get(),opacity:.35,containment:c("#daDesktop")}),b.$dialogContainer.on("max.pkui.dialog",function(){b.$dialogContainer.draggable("disable"),b.$dialogContent.resizable("disable")}).on("restore.pkui.dialog",function(){b.$dialogContainer.draggable("enable"),b.$dialogContent.resizable("enable")}),this},setTop:function(a){return a.focus(),this},setMax:function(a){var b,e,f,g,h,i;return h=a.options.pkuiOptions,b=d.getPageWidth(),e=d.getPageHeight(),i=c("#daTopbar"),f=i.outerHeight()+2,g=h.$dialogHeader.outerHeight(),h.originWidth=h.$dialogContainer.width(),h.originHeight=h.$dialogContainer.outerHeight(),h.originTop=h.$dialogContainer.css("top"),h.originLeft=h.$dialogContainer.css("left"),h.$dialogContainer.css({top:"0px"===i.css("bottom")?0:f,left:0}),h.$dialogContent.css({width:b,height:e-f-g}),h.$dialogContainer.trigger("max.pkui.dialog"),this},doRestore:function(a){var b;return b=a.options.pkuiOptions,b.$dialogContent.css({width:b.originWidth,height:b.originHeight-b.$dialogHeader.height()}),b.$dialogContainer.css({top:b.originTop,left:b.originLeft}),b.$dialogContainer.trigger("restore.pkui.dialog"),this},setMin:function(a){var b=a.options.pkuiOptions;return a.close(),b.$dialogContainer.trigger("min.pkui.dialog"),this},_bindMinEvent:function(a){var b=a.options.pkuiOptions,c=this;return b.$minBtn.on("click.window.app",function(){c.setMin(a)}),this},_bindMaxEvent:function(a){var b,d;return b=this,d=a.options.pkuiOptions,d.$maxBtn.on("click.window.app",function(){b.setMax(a),c(this).hide(),d.$restoreBtn.show()}),d.$restoreBtn.on("click.window.app",function(){b.doRestore(a),c(this).hide(),d.$maxBtn.show()}),this}},f.defaults={isNotCenter:!0,width:800,height:480,$dialogContainer:null,$dialog:null,$dialogHeader:null,$dialogContent:null,$minBtn:null,$maxBtn:null,$restoreBtn:null,originWidth:0,originHeight:0,originTop:0,originLeft:0,resizable:!0,canMinimized:!0,canMaximized:!0,canDragged:!0},f});