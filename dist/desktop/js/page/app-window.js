define(function(a){function b(a){this.appInstance=null,this.options=null,this.artDialog=null,this.title=null,this.content=null,this._init(a)}var c,d,e,f,g,h,i;return c=a("jquery"),d=a("../common/dialog"),e=a("artTemplate"),f=a("../../tpl/desktop/appWindow.html"),g=e.compile(f),h=a("../../tpl/desktop/appWindowMain.html"),i=e.compile(h),a("isLoading"),b.prototype.defaults={icon:"",title:"",src:"",isMaxOnInit:!0,hasSidebar:!0,width:600,height:400,content:"<i class='pkui-content-loading-ring'></i>"},c.extend(b.prototype,{create:function(){var a,c;return a=this,a.artDialog=d.create({title:a.title,content:a.content,url:"iframe"===this.options.mode?this.options.src:null,width:a.options.width,height:a.options.height,onclose:function(){a.appInstance.appDock.hide()},oniframeload:function(){a.artDialog.options.pkuiOptions.$dialogContent.children(".pkui-content-loading-ring").remove()}}),"iframe"===this.options.mode&&a.artDialog.options.pkuiOptions.$dialogContent.append(b.prototype.defaults.content),this.artDialog.show(),this.artDialog.__center(),this.options.isMaxOnInit&&(c=this.artDialog.options.pkuiOptions,c.$dialogContainer.stop(),c.$maxBtn.trigger("click.window.app")),this},show:function(){return this.artDialog.show(),this},hide:function(){this.artDialog.close()},destroy:function(){return this.artDialog&&this.artDialog.remove(),this.appInstance&&(this.appInstance.isAppWindowDestroy=!0),this.options=null,this.title=null,this.content=null,this.appInstance=null,this}}),c.extend(b.prototype,{_init:function(a){return this.options=c.extend({},this.defaults,a),this.title=this._getTitle(),"default"===this.options.mode&&(this.content=this._getContent()),this.create(),this._bindEvent(),this},_getTitle:function(){var a,b,c;return a=this.options.icon||"",c=this.options.title||"",b=a?'<img class="pkui-dialog-title-icon" src="'+a+'">':"",b+c},_getContent:function(){var a,b,d,e;return a=this,(b=this.options.src)?(d=g({}),c.ajax({type:"GET",cache:!1,dataType:"text",url:b}).done(function(b){var f,g;e=b,g=c("<div>"),g.append(d).find(".win-main-body").html(e),f=g.html(),a.options.content=f,a.artDialog.content(f),g=null}).fail(function(b,c){throw a.artDialog.content("/(ㄒoㄒ)/~~[ "+c+" ]获取数据失败"),"/(ㄒoㄒ)/~~[ "+c+" ]获取数据失败"}),this.options.content):'<h1>+_+ 请设置src，如下：</h1><pre>&lt;div data-pkui-app="true" \n     data-pkui-app-options=\'{ \n         "icon": "./images/apps/app_01.png", \n         "title": "执法监督综合应用门户", \n         "src": "./tpl/system/manage.html" }\'></pre>'},_bindEvent:function(){var a,b=this.artDialog.options.pkuiOptions;return a=this,this.artDialog.addEventListener("remove",function(){a.artDialog=null,a.appInstance&&!a.appInstance.isAppDestroy&&a.appInstance.destroy()}),b.$dialogContainer.on("mousedown.dock.app",function(){a.appInstance.show()}),b.$dialogContainer.on("click.sidebar",".sidebar-collapse-toggle",function(){c(this).toggleClass("collapsed"),b.$dialogContainer.find(".da-win-sidebar").toggleClass("collapsed"),b.$dialogContainer.find(".da-win-main").toggleClass("collapsed")}),b.$dialogContainer.on("click.sidebar.anchor",".sidebar-menuItem-anchor",function(a){var d,e,f,g,h=c(this);return a.preventDefault(),h.is(".sidebar-submenu-toggle")?void h.siblings(".sidebar-submenu").toggle():(h.parent().addClass("active").siblings().removeClass("active"),d=h.find("img").attr("src"),e=h.text(),f=c(i({iconSrc:d,title:e})),b.$dialogContainer.find(".da-win-main").replaceWith(f),g=f.children(".win-main-body"),g.isLoading(),void c.ajax({type:"GET",cache:!1,dataType:"text",url:h.attr("href")}).done(function(a){g.html(a)}).fail(function(a,b){throw g.html("/(ㄒoㄒ)/~~[ "+b+" ]获取数据失败"),"/(ㄒoㄒ)/~~[ "+b+" ]获取数据失败"}).always(function(){g.isLoading("hide")}))}),this}}),b});