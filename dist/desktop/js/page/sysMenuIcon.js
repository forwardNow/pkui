define(function(a){function b(a){return this.opts=c.extend(!0,{},this.defaults,a),c(this.opts.containerSelector).data(f)?void console.info("已经初始化过..."):(c(this.opts.containerSelector).data(f,!0),void this._init())}var c=a("jquery"),d=window.PKUI,e=window.layer,f="pkui.sysmenu.icon";return a("bootstrap-tab"),b.prototype.defaults={menuIconInputSelector:"#sysMenuIconInput",containerSelector:"#menuiconContainer",tabSelector:".nav-tabs a",fontIconInputSelector:"#sysMenuFontIconInput",fontIconDisplayAreaSelector:"#sysMenuFontIconDisplayArea",imageIconInputSelector:"#sysMenuImageIconInput",imageIconChooseAreaSelector:"#sysMenuImageIconChooseArea"},b.iconNameList=null,b.prototype._init=function(){this._render(),this._bind()},b.prototype._render=function(){var a,b=this.opts;this.$container=c(b.containerSelector),a=this.$container,this.$menuIconInput=a.find(b.menuIconInputSelector),this.icon=this.$menuIconInput.val(),this.$tab=a.find(b.tabSelector),this.$fontIconInput=a.find(b.fontIconInputSelector),this.$fontIconDisplayArea=a.find(b.fontIconDisplayAreaSelector),this.$imageIconInput=a.find(b.imageIconInputSelector),this.$imageIconChooseArea=a.find(b.imageIconChooseAreaSelector)},b.prototype._bind=function(){var a=this;this.$tab.tab(),this.$fontIconInput.off("input."+f).on("input."+f,function(){var b=this.value;b&&b.indexOf("fa-")!==-1&&(a.$fontIconDisplayArea.html('<i class="'+b+'"></i>'),a.$menuIconInput.val(b))}),this.$tab.eq(1).on("shown.bs.tab",function(){var b=c(this),g=b.data("status."+f);return"loading"===g?void e.msg("正在载入图片，请稍等！"):void("loaded"!==g&&(b.data("status."+f,"loading"),a._getIconNameList(function(e){var g="",h=d.iconPath+"/24x24/",i=a.icon;c.each(e,function(a,b){var c=b.iconName,d=i===c,e=h+c;g+=d?"<div class='item' data-icon-name='"+c+"'><img src='"+e+"' class='active'></div>":"<div class='item' data-icon-name='"+c+"'><img src='"+e+"'></div>"}),a.$imageIconChooseArea.html(g),a.$imageIconInput.text()&&a.$imageIconChooseArea.find('[data-icon-name="'+a.$imageIconInput.text()+'"]').addClass("active"),b.data("status."+f,"loaded")})))}),this.$imageIconChooseArea.on("click."+f,".item",function(){var b=c(this),d=b.attr("data-icon-name");b.addClass("active").siblings().removeClass("active"),a.$imageIconInput.text(d),a.$menuIconInput.val(d)}),this._showTab()},b.prototype._showTab=function(){var a=this.icon;a&&(a.indexOf("fa-")!==-1?(this.$tab.eq(0).tab("show"),this.$fontIconInput.val(a).trigger("input."+f)):a.indexOf(".png")!==-1&&(this.$imageIconInput.text(this.icon),this.$tab.eq(1).tab("show")))},b.prototype._getIconNameList=function(a){var d=this;if("function"!=typeof a)throw"需要传递一个回调函数作为参数。";return b.iconNameList?void a(b.iconNameList):(this.$imageIconChooseArea.isLoading({position:"insideButton"}),void c.ajax({url:"{% system.menu.edit.js.sysMenuIconsDataExt %}"}).done(function(d){var f;d&&(d.success||d.totalRecords>=0)?(f=d.data,f&&c.isArray(f)&&f.length>0&&(b.iconNameList=f),a(f)):e.alert("【系统菜单模块】获取图标名称失败：服务器内部错误。",{icon:2})}).fail(function(){e.alert("【系统菜单模块】获取图标名称失败：网络错误/登陆失效！",{icon:0})}).always(function(){d.$imageIconChooseArea.isLoading("hide")}))},b});