define(function(a){"use strict";var b=a("jquery"),c={};return a("isLoading"),c.namespace="pkui.drawer",c.defaults={ajax:!0,url:"",showOverlay:!0,state:!1,isCreated:!1,container:".drawer-container",$container:null,$drawer:null,$drawerContent:null,$drawerButton:null,$overlay:null,onOpen:null,onHide:null,onDestroy:null,onLoad:null},c.clazz={drawer:"pkui-drawer",button:"pkui-drawer-button",overlay:"pkui-drawer-overlay",open:"pkui-drawer-open"},b.extend(c,{_create:function(){var a,d,e=this,f=b(this),g=f.data(c.namespace),h=g.options;a=b(h.container),a.size()>1&&(a=f.closest(h.container)),h.$container=a,"static"==a.css("position")&&a.css("position","relative"),h.showOverlay&&c.addOverlay.call(e),d=b('<div class="pkui-drawer"><button href="#" class="pkui-drawer-button">&#215;</button><div class="pkui-drawer-content"></div></div>').addClass(c.clazz.drawer).appendTo(a),h.$drawer=d,h.$drawerContent=d.find(".pkui-drawer-content"),h.$drawerButton=d.find(".pkui-drawer-button"),h.$drawerButton.on("click."+c.namespace,function(){c.destroy.call(e)}),h.isCreated=!0},init:function(){return this.each(function(){var a,d=b(this),e=d.data(c.namespace);e&&d.attr("isrendered")||(a=b.extend({},c.defaults,d.data(PKUI.optionsMarkupProp)),d.data(c.namespace,{options:a}),d.on("click."+c.namespace,function(){d.drawer("open")}),d.attr("isrendered",!0))})},getOptions:function(){var a=this.jquery?this:b(this);return a.data(c.namespace).options},open:function(){var a=b(this),d=c.getOptions.call(this);d.isCreated||c._create.call(this),d.$drawer.animate({left:"0"},function(){var b=d.onOpen;window[b]&&"function"==typeof window[b]&&window[b].call(a),a.trigger("open."+c.namespace)}),d.$container.addClass(c.clazz.open),d.ajax&&d.url&&(d.$drawer.isLoading(),b.ajax({url:d.url,type:"GET",cache:!1,dataType:"text"}).done(function(a){d.$drawerContent.html(a)}).fail(function(a,b){d.$drawerContent.html("/(ㄒoㄒ)/~~[ "+b+" ]网络错误。"),console.info("/(ㄒoㄒ)/~~[ "+b+" ]网络错误。")}).always(function(){d.$drawer.isLoading("hide")}))},hide:function(){var a=b(this),d=a.data(c.namespace).options;d.$drawer.animate({left:"100%"},function(){var b=d.onHide;d.$container.removeClass(c.clazz.open),d.$overlay.hide(),window[b]&&"function"==typeof window[b]&&window[b].call(a),a.trigger("hide."+c.namespace)})},destroy:function(){var a=b(this),d=a.data(c.namespace).options;d.$drawer.animate({left:"100%"},function(){var b=d.onDestroy;d.$container.removeClass(c.clazz.open),d.$drawer.remove(),d.$overlay.remove(),d.isCreated=!1,window[b]&&"function"==typeof window[b]&&window[b].call(a)})},addOverlay:function(){var a=b(this),d=b("<div>").addClass(c.clazz.overlay),e=a.data(c.namespace).options;return e.$overlay=d,e.$container.append(d),a}}),b.fn.drawer=function(a){return c[a]?c[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void b.error("Method "+a+" does not exist on ["+c.namespace+"]"):c.init.apply(this,arguments)},window.PKUI.component.drawer=b.fn.drawer,{}});