define(function(a){function b(a,b){this.$target=a,this.options=d.extend(!0,{},this.defaults,b),this._init()}function c(a,b){var c=[],e="jstree_"+(new Date).getTime()+"_";return d.each(a,function(a,f){var g=f.icon||"fa fa-file-o",h="1"===f.visiable;(h||b)&&(c.push(f),g&&g.indexOf(".png")!==-1&&(g=window.PKUI.iconPath+"/24x24/"+g),f.data=d.extend(!0,{},f),f.a_attr={href:f.menuUrl?window.PKUI.ctxPath+f.menuUrl:"#",menuicon:g},f.id=e+f.menuId,f.text=f.menuName,f.icon=g,f.state={opened:"1"===f.expand})}),c}a("../3.3.4/jstree.js"),a("../3.3.4/themes/default/style.css"),a("./style.css");var d=a("jquery"),e="pkui.menutree",f=window.layer;return b.prototype.defaults={url:"",dnd:!1,menuId:null,showInvisible:!1,isFirstMenuItemSelected:!1,isHideSingleRootNode:!1},b.cache={},b.prototype._init=function(){function a(a){var b,d,f,h,i={};b=a.data,d=c(b,g.showInvisible),f=window.PKUI.getTreeList({data:d,rootId:g.menuId,idName:"menuId",parentIdName:"treeParentid",childrenName:"children"}),1===f.length&&g.isHideSingleRootNode&&(h=f[0].children,h&&0!==h.length&&(f=h)),i.core={data:f,worker:!1,multiple:!1,themes:{dots:!0},check_callback:!0},i.plugins=["wholerow"],g.dnd&&i.plugins.push("dnd"),e.$target.jstree(i),e.$target.addClass("jstree-menutree")}var e=this,g=this.options,h=g.url;return b.cache[h]?void a(b.cache[h]):(e.$target.isLoading(),void d.ajax({url:h}).done(function(c){return c&&c.success!==!1&&null!==c.data&&void 0!==c.data?(b.cache[h]=c,void a(c)):void f.msg(c&&c.message||"菜单树构建失败！",{icon:2})}).fail(function(a){var b="菜单树构建失败："+a.status+" ("+a.statusText+")";f.msg(b,{icon:0}),console.error(b)}).always(function(){e.$target.isLoading("hide")}))},d.fn.MenuTree=function(a){return this.each(function(){var c=d(this),f=c.data(e);f||(c.attr("isrendered",!0),f=new b(c,a),c.data(e,f))}),this},window.PKUI.component.menuTree=d.fn.MenuTree,b});