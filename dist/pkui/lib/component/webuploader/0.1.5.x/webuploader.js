define(function(a){function b(a,b){var f,g,h,i,j,k,l,m,n,o,p;return g={pick:"#"+a+" .uploader-picker",dnd:"#"+a+" .uploader-filelist"},b=d.extend(g,c.prototype.defaults,b||{}),f=b._type,h=d("#"+a).html(c.prototype.defaults._template).addClass("uploader-theme-"+f),i=d(".uploader-filelist",h),j=d(".uploader-startup",h),k=d(".uploader-info",h),n=window.devicePixelRatio||1,o=100*n,p=100*n,m=e.create(b),m.on("all",function(a){"startUpload"===a?l="uploading":"stopUpload"===a?l="paused":"uploadFinished"===a&&(l="done"),"uploading"===l?j.html('<i class="fa fa-upload"></i> 暂停上传').addClass("btn-warning"):j.html('<i class="fa fa-upload"></i> 开始上传').removeClass("btn-warning")}),j.on("click",function(){"uploading"===l?m.stop(!0):m.upload()}),m.on("fileQueued",function(a){var b,c,g,h,j;b=a.id,c=a.name,g=e.formatSize(a.size),"file"==f?h=d('<li class="uploader-fileitem" id='+b+'>                                <button type="button" class="close">&times;</button>                                <span class="filename">'+c+" ("+g+') - </span>                                <span class="state">等待上传</span>                                <div class="uploader-progress">                                   <div class="uploader-progress-bar" style="width: 1%;"></div>                                </div>                           </li>'):"image"==f&&(h=d('<li class="uploader-fileitem" id='+b+'>                                <button type="button" class="close">&times;</button>                                <div class="thumbnail"><img /></div>                                <span class="filename">'+c+" ("+g+') - </span>                                <span class="state">等待上传</span>                                <div class="uploader-progress">                                   <div class="uploader-progress-bar" style="width: 1%;"></div>                                </div>                           </li>'),j=h.find("img"),m.makeThumb(a,function(a,b){return a?void j.replaceWith('<span class="text-danger">不能预览!</span>'):void j.attr("src",b)},o,p)),i.append(h)}),i.on("click","button.close",function(){var a,b,c;a=d(this),b=a.parent(".uploader-fileitem"),c=b.attr("id"),m.cancelFile(c),b.fadeOut()}).on("click",".state > a",function(){var a,b,c;return a=d(this),b=a.closest(".uploader-fileitem"),c=b.attr("id"),m.retry(m.getFile(c)),!1}),m.on("uploadProgress",function(a,b){var c,e;c=d("#"+a.id),e=c.find(".uploader-progress-bar"),c.addClass("uploading").find(".state").text("上传中"),e.css("width",100*b+"%")}),m.on("uploadSuccess",function(a,b){b.success?d("#"+a.id).addClass("success").find(".state").text("已上传").end().find(".close").hide():d("#"+a.id).addClass("error").find(".state").text(b.message||"已上传，但服务器端处理失败。")}),m.on("uploadError",function(a){d("#"+a.id).addClass("error").find(".state").html('上传出错 <a href="#">重新上传</a>')}),m.on("uploadComplete",function(a){var b,c,d;b=m.getStats(),c=b.successNum,d=b.uploadFailNum,k.text("已上传成功文件数："+c+"。 上传失败文件数："+d+"。")}),m.on("error",function(a){switch(a){case"F_EXCEED_SIZE":alert("单个文件大小不符合要求：不超过"+b.fileSingleSizeLimit/1024+"KB。");break;case"Q_TYPE_DENIED":alert("文件类型不符合要求：仅限 "+b.accept.extensions+" 类型。");break;case"Q_EXCEED_NUM_LIMIT":alert("文件总数量不符合要求：超过"+b.fileNumLimit+"。");break;case"Q_EXCEED_SIZE_LIMIT":break;default:alert("错误类型："+a)}}),m}a("../0.1.5/webuploader.js"),a("./webuploader.css");var c,d=a("jquery"),e=window.WebUploader,f="pkui.uploader";return c=function(a,c){var e=d(a);e.attr("id")||e.attr("id","uploader_"+(new Date).getTime()),this.WebUploaderInstance=b(e.attr("id"),c)},c.prototype.defaults={server:"http://localhost:8080/pkui/upload",auto:!1,fileSingleSizeLimit:8388608,swf:window.PKUI.basePath+"/lib/component/webuploader/0.1.4/Uploader.swf",resize:!1,_type:"file",_template:'<ul class="uploader-filelist clearfix" title="可将文件拖拽到此区域进行上传"></ul><div class="uploader-controls">    <div class="uploader-picker"><i class="fa fa-file-o"></i> 选择文件</div>    <button type="button" class="btn btn-success uploader-startup" ><i class="fa fa-upload"></i>  开始上传</button>    <span class="text-warning uploader-info">已上传成功文件数：0。 上传失败文件数：0。</span></div>'},d.fn.Uploader=function(a){return this.each(function(){var b=d(this),e=b.data(f);e||(b.attr("isrendered",!0),e=new c(this,a),b.data(f,e))}),this},window.PKUI.component.webuploader=d.fn.Uploader,c});