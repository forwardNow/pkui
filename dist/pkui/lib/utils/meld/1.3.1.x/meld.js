!function(a){a(function(){function a(a,b,g){var h,i;return arguments.length<3?c(a,b):(y(b)?i=e(a,b,g):(h=typeof b,"string"===h?"function"==typeof a[b]&&(i=d(a,b,g)):i="function"===h?e(a,b(a),g):f(a,b,g)),i)}function b(a,b){var c,d,e;this.target=a,this.func=b,this.aspects={},c=this.orig=a[b],d=this,e=this.advised=function(){function a(a){var b=j(a);return d._callSimpleAdvice("on",g,a),b}function f(a,b){d._callSimpleAdvice(a,g,b)}var g,h,i,j,l;this instanceof e?(g=A(c.prototype),j=function(a){return k(c,g,a)}):(g=this,j=function(a){return c.apply(g,a)}),i=x.call(arguments),l="afterReturning",h=o({target:g,method:b,args:i});try{d._callSimpleAdvice("before",g,i);try{h.result=d._callAroundAdvice(g,b,i,a)}catch(a){h.result=h.exception=a,l="afterThrowing"}if(i=[h.result],f(l,i),f("after",i),h.exception)throw h.exception;return h.result}finally{p()}},z(e,"_advisor",{value:d,configurable:!0})}function c(a,b){var c,e;return c=a.name||"_",e={},e[c]=a,d(e,c,b),e[c]}function d(a,c,d){var e=b.get(a,c);return e&&e.add(d)}function e(a,b,c){var e,f,h,i;for(e=[],i=0;h=b[i++];)f=d(a,h,c),f&&e.push(f);return g(e)}function f(a,b,c){var e=[];for(var f in a)"function"==typeof a[f]&&b.test(f)&&e.push(d(a,f,c));return g(e)}function g(a){return{remove:function(){for(var b=a.length-1;b>=0;--b)a[b].remove()}}}function h(b){return function(c,d,e){var f={};return 2===arguments.length?(f[b]=d,a(c,f)):(f[b]=e,a(c,d,f))}}function i(a,b){var c,d,e;for(c in w)d=b[c],d&&(e=a[c],e||(a[c]=e=[]),e.push({aspect:b,advice:d}))}function j(a,b){var c,d,e;e=0;for(c in w)if(d=a[c]){e+=d.length;for(var f=d.length-1;f>=0;--f)if(d[f].aspect===b){d.splice(f,1),--e;break}}return e}function k(a,b,c){try{z(b,"constructor",{value:a,enumerable:!1})}catch(a){}return a.apply(b,c),b}function l(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c])}function m(a,b){for(var c=a.length-1;c>=0;--c)b(a[c])}function n(){return r}function o(a){return s.push(r),r=a}function p(){return r=s.pop()}function q(){try{return"x"in Object.defineProperty({},"x",{})}catch(a){}}a.before=h("before"),a.around=h("around"),a.on=h("on"),a.afterReturning=h("afterReturning"),a.afterThrowing=h("afterThrowing"),a.after=h("after"),a.joinpoint=n,a.add=function(){return a.apply(null,arguments)},b.prototype={_callSimpleAdvice:function(a,b,c){var d,e;e=this.aspects[a],e&&(d=w[a])(this.aspects[a],function(a){var d=a.advice;d&&d.apply(b,c)})},_callAroundAdvice:function(a,b,c,d){function e(a,b){return a<0?d(b):f(h[a].advice,a,b)}function f(c,d,f){function g(){return k}function h(){return j(arguments.length>0?x.call(arguments):f)}function i(a){return j(a||f)}function j(a){return k++,e(d-1,a)}var k,l;k=0,l=o({target:a,method:b,args:f,proceed:h,proceedApply:i,proceedCount:g});try{return c.call(a,l)}finally{p()}}var g,h;return h=this.aspects.around,g=h?h.length:0,e(g-1,c)},add:function(a){var b,c;return b=this,c=b.aspects,i(c,a),{remove:function(){var d=j(c,a);d||b.remove()}}},remove:function(){delete this.advised._advisor,this.target[this.func]=this.orig}},b.get=function(a,c){if(c in a){var d,e;if(e=a[c],"function"!=typeof e)throw new Error("Advice can only be applied to functions: "+c);return d=e._advisor,d||(d=new b(a,c),a[c]=d.advised),d}};var r,s,t,u,v,w,x,y,z,A;return s=[],t=Array.prototype,u=t.unshift,v=t.push,x=t.slice,y=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)},z=q()?Object.defineProperty:function(a,b,c){a[b]=c.value},A=Object.create||function(){function a(){}return function(b){a.prototype=b;var c=new a;return a.prototype=null,c}}(),w={before:m,around:!1},w.on=w.afterReturning=w.afterThrowing=w.after=l,a})}("function"==typeof define&&(define.amd||define.cmd)?define:function(a){module.exports=a()});